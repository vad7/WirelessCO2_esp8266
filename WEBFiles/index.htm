<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-type" content="text/html; charset=windows-1251">
<title>Вентиляция</title>
<link rel="stylesheet" href="/style.css">
<script src="/site.js"></script>
</head><body onload="CreateTable()">
~inc:menu0.inc~
<div class="content">
<h2 class="title"><span style="font-weight:normal">CO<small><sub>2</sub></small>:</span>&nbsp;&nbsp;<span id="co2">~CO2_current~</span>&nbsp;<span style="font-weight:normal"><small>ppm</small></span></h2>
<p class="center">
<span id="time_co2">~CO2_last_time~</span>
</p>
<p id="now_night" align="right"></p>
<table id="fans" class="mdbtab">
	<tr><th>№</th><th>Место</th><th>Скорость</th><th>Отправлена</th><th colspan="3">Корректировка</th></tr>
</table>
Корректировать: Скорость:&nbsp;<input title="-6..6" id="cfg_vars_fans_speed_ov" maxlength="2" size="3" value="~cfg_vars_fans_speed_ov~">&nbsp;&nbsp;
Ночь: <input type="checkbox" id="now_night_ov">
<button type="button" onclick="SetOnChange()">установить</button>
<br>
<br>
Текущее время: <span id="time_sntp">~sntp_time~</span>&nbsp;(~sntp_status~)<br>
Время включения: <span id="timerst">~sys_mactime~</span><br>
Питание: <span title="Vdd" id="syspower">?</span> V<br>
</div>
~inc:footer.inc~
~inc:vdd.inc~
~inc:time.inc~
<script type="text/javascript">
function SetOnChange() {
	newAJAXCommand('?now_night='+(document.getElementById('now_night_ov').checked ? '1':'0') + '&cfg_vars_fans_speed_ov='+document.getElementById('cfg_vars_fans_speed_ov').value);
}
function CreateTable() {
	for(var i = 0; i < ~cfg_co2_fans~; i++){
		r=document.all.fans.insertRow(-1);
		(r.insertCell(0)).innerHTML = i+1;
		r.insertCell(1);
		r.insertCell(2);
		r.insertCell(3);
		c=r.insertCell(4);c.innerHTML="+";c.idx=i;c.onclick=function(){newAJAXCommand("?cfg_fan_="+this.idx+"&cfg_fan_override=p")};c.className='s';
		c=r.insertCell(5);c.innerHTML="-";c.idx=i;c.onclick=function(){newAJAXCommand("?cfg_fan_="+this.idx+"&cfg_fan_override=m")};c.className='s';
		c=r.insertCell(6);c.innerHTML="*";c.idx=i;c.onclick=function(){newAJAXCommand("?cfg_fan_="+this.idx+"&cfg_fan_override=c")};c.className='s';
	}
	newAJAXCommand('fans.xml', updateStatus, true);
}
function updateStatus(xmlData) {
	if(!xmlData) return;
	var total = getXMLValue(xmlData, 'total');
	document.getElementById('now_night').innerHTML = getXMLValue(xmlData, 'night') == '1' ? '* ночь * ' : '';
	document.getElementById('co2').innerHTML = getXMLValue(xmlData, 'co2');
	document.getElementById('time_co2').innerHTML = getXMLValue(xmlData, 'time_co2');
	document.getElementById('time_sntp').innerHTML = getXMLValue(xmlData, 'time_sntp');
	for(i = 0; i < total; i++){
		var r = document.all.fans.rows[i+1];
		var f = xmlData.getElementsByTagName('fan')[i];
		r.cells[1].innerHTML = getXMLValue(f, 'name');
		if(getXMLValue(f, 'fl') & 1) r.cells[1].style.color = 'gray';
		r.cells[2].innerHTML = getXMLValue(f, 'spc');
		r.cells[2].style.color = (getXMLValue(f, 'fl') & 2) ? 'red' : '';
		var du = getXMLValue(f, 'ttm') * 1000; d = new Date(du);
		r.cells[3].innerHTML = du == 0 ? '---' : d.toTimeString().substr(0,8);
		r.cells[3].style.color = (getXMLValue(f, 'tst') > 1) ? 'red' : '';
	}
	updTime();
	nextimeout = ~cfg_co2_refresh_t~;
}
if(~cfg_co2_fans~ == "0") document.all.fans.hidden = true;
document.getElementById('now_night_ov').checked = ~now_night_override~ == '1' ? true : false;
</script>
</body></html>